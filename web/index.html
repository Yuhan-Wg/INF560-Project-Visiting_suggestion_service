<html>

<head>

<link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="./buttons.css" rel="stylesheet" media="screen">
<link href="./date-picker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">

<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://d3js.org/d3-queue.v3.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>

<script type="text/javascript" src="./jquery/jquery-1.8.3.min.js" charset="UTF-8"></script>
<script type="text/javascript" src="./bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="./date-picker/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<!--
<script type="text/javascript" src="./date-picker/js/locales/bootstrap-datetimepicker.us.js" charset="UTF-8"></script> 
-->

<!--
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
-->

<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>


<style>
        #heatmap  {
            width:600px; height:400px;border: 1px solid;border-color: grey;
        }
    </style>      
</head>

<body>
<!-- Add a date time & picker using Bootstrap -->
  <div class="container">
    <form action="" class="form-horizontal"  role="form">
        <fieldset>

            <legend>Choose Date and Time</legend>

            <div class="form-group">
                <label for="dtp_input1" class="col-md-2 control-label">DateTime Picking</label>
                <div class="input-group date form_datetime col-md-5" data-date="2018-04-25T09:30:00Z" data-date-format="dd MM yyyy ----- HH:ii p" data-link-field="dtp_input1">
                    <input class="form-control" size="18" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
					<span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>
				<input type="hidden" id="dtp_input1" value="" /><br/>
            </div>

<!--
			<div class="form-group">
                <label for="dtp_input2" class="col-md-2 control-label">Date Picking</label>
                <div class="input-group date form_date col-md-5" data-date="" data-date-format="dd MM yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
					<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                </div>
				<input type="hidden" id="dtp_input2" value="" /><br/>
            </div>
			<div class="form-group">
                <label for="dtp_input3" class="col-md-2 control-label">Time Picking</label>
                <div class="input-group date form_time col-md-5" data-date="" data-date-format="hh:ii" data-link-field="dtp_input3" data-link-format="hh:ii">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
					<span class="input-group-addon"><span class="glyphicon glyphicon-time"></span></span>
                </div>
				<input type="hidden" id="dtp_input3" value="" /><br/>
            </div>
-->
            
            <div class="col-md-2"></div>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="heatmap" checked> Heatmap
                
            </label>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="time" checked> Best Visiting Time
            </label> 

            <br>
            <br>

            <div class="col-md-2"></div>
            <div class="button-group">
            <button onclick="floorb1();fun()" class="button button-glow button-rounded button-caution" id = "fb1"  type="button">B1F</button>
            <button onclick="floor1();fun()" class="button button-glow button-rounded button-caution" id = "f1"  type="button">1F</button>
            <button onclick="floor5();fun()" class="button button-glow button-rounded button-caution" id = "f5"  type="button">5F</button>
            </div>


<!--      

            <button onclick="fun()" class="button button-glow button-rounded button-caution" id = "reset"  type="button">Heatmap</button>
            <button onclick="fun()" class="button button-glow button-rounded button-caution" id = "reset"  type="button">Best Time</button>
-->
        </fieldset>
    </form>
</div>    

<div class="col-md-7">
    <svg id = "heat" version="1.1"    width="1500" height="800" viewBox="-170 180 1800 800"
     

        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">

       <image xlink:href="floor b1.png" width="1500" height="800"/>

       

    </svg>

</div>

<!--     
<div id="heatmap"></div>   
-->    
<script type="text/javascript">

var floor = 0;
console.log(floor)

var flag =""

function skyscale(x, y,minX,maxX,minY,maxY) {
    if(y>39){console.log("!!!!!!!!")}
    var scalex = d3.scaleLinear();
		scalex.domain([0,60])
		     .range([190,1390]);				 
    var newx = scalex(x);
    
    var scaley = d3.scaleLinear();
		scaley.domain([0,20])
		     .range([200,590]);				 
    var newy = scaley(y);
    //console.log(x, y,minX,maxX,minY,maxY)
    return [newx, newy];
}

function scale1(x, y,minX,maxX,minY,maxY) {
    if(y>39){console.log("!!!!!!!!")}
    var scalex = d3.scaleLinear();
		scalex.domain([0,60])
		     .range([165,1380]);				 
    var newx = scalex(x);
    
    var scaley = d3.scaleLinear();
		scaley.domain([0,20])
		     .range([195,570]);				 
    var newy = scaley(y);
    //console.log(x, y,minX,maxX,minY,maxY)
    return [newx, newy];
}

function scale5(x, y,minX,maxX,minY,maxY) {
    if(y>39){console.log("!!!!!!!!")}
    var scalex = d3.scaleLinear();
		scalex.domain([0,30])
		     .range([210,1450]);				 
    var newx = scalex(x);
    
    var scaley = d3.scaleLinear();
		scaley.domain([0,20])
		     .range([200,570]);				 
    var newy = scaley(y);
    //console.log(x, y,minX,maxX,minY,maxY)
    return [newx, newy];
}

function floorb1(){
    d3.selectAll("image").remove()
    d3.selectAll("g").remove()
    g = d3.select("#heat")
            .append("image")
            .attr("xlink:href","floor b1.png")
            .attr("width","1500")
            .attr("height","800")

    floor = 0
    console.log(floor)

}

function floor1(){
    d3.selectAll("image").remove()
    d3.selectAll("g").remove()
    g = d3.select("#heat")
            .append("image")
            .attr("xlink:href","floor 1.png")
            .attr("width","1500")
            .attr("height","800")

    floor = 1
    console.log(floor)
    //console.log("$$$$$$$$$$$")
    

}

function floor5(){
    d3.selectAll("image").remove()
    d3.selectAll("g").remove()
    g = d3.select("#heat")
            .append("image")
            .attr("xlink:href","floor 5.png")
            .attr("width","1500")
            .attr("height","800")

    floor = 5
    console.log(floor)
/*
    d3.select("#heat")
        .append("rect")
        .attr("width","24")
        .attr("height","7")
        .attr("x","210")
        .attr("y","570")
        .attr("fill","black")
*/
}



function fun(){

//alert($("input[name='inlineRadioOptions']:checked").val());

var flag = $("input[name='inlineRadioOptions']:checked").val();
/*
for(i=0;i<document.getElementsByName("inlineRadioOptions").length;i++)
 {
  if(document.getElementsByName("inlineRadioOptions")[i].checked == true)
  {
   flag = document.getElementsByName("inlineRadioOptions")[i].value;
  }
  else continue;
 }
*/

//flag = document.getElementsByName("inlineRadioOptions")[0].value

console.log(flag)

d3.selectAll("g").remove()
//var x = document.getElementById("dtp_input2").value
//var y = document.getElementById("dtp_input3").value

if(flag == "heatmap")
{
var dt = document.getElementById("dtp_input1").value
//console.log(z)

//Get Date and Time for timepicker
var z = dt.split(" ")

var month = z[0].split("-")[1]



if(month[0] == "0")
{
    month = month[1]
}
var day = z[0].split("-")[2]
var hour = z[1].split(":")[0]
var minute = 0
if(day[0] == "0")
{
    day = day[1]
}
if(hour[0] == "0")
{
    hour = hour[1]
}

var file = "data/"+month+"/"+day+"/"
}

/*
if( z[1].split(":")[1] == "00" || z[1].split(":")[1] == "05"|| z[1].split(":")[1] == "10")
{
    minute = 0
}
else if( z[1].split(":")[1] == "15" || z[1].split(":")[1] == "20"|| z[1].split(":")[1] == "25")
{
    minute = 1
}
else if( z[1].split(":")[1] == "30" || z[1].split(":")[1] == "35"|| z[1].split(":")[1] == "40")
{
    minute = 2
}
else if( z[1].split(":")[1] == "45" || z[1].split(":")[1] == "50"|| z[1].split(":")[1] == "55")
{
    minute = 3
}
*/

//console.log(month)
//console.log(day)
//console.log(hour)
//console.log(minute)
if(flag == "heatmap")
{
if(floor == 0)
{
//target = file+"level0.csv"
//console.log(target)
d3.csv(file+"level0.csv"
, function (d) {  //d contains datum of current row


    if(d.Level == 0 && d.hour == hour )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
//console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);

var svg = d3.select("#heat")
    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+590-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})

}
else if(floor == 1)
{



d3.csv(file+"level1.csv"
, function (d) {  //d contains datum of current row
    //console.log(d)
    if(d.Level == 1 && d.hour == hour )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);

var svg = d3.select("#heat")
    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (195+570-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})

}
else if(floor ==5)
{
    d3.csv(file+"level5.csv"
, function (d) {  //d contains datum of current row
    //console.log(d)
    if(d.Level == 5 && d.hour == hour )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-30,50])
  .range(['#EFECEC','#CE0000']);

var svg = d3.select("#heat")
    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+570-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})

}
}


else if(flag == "time")
{



   if(floor == 0)
   {
    var svg = d3.select("#heat")
    d3.csv("data/4/25/level0.csv"
    //d3.csv(file+"level0.csv"
        , function (d) {  //d contains datum of current row


    if
    (
        ((d.latBlock == 10 && d.lngBlock == 25 )||
        (d.latBlock == 9 && d.lngBlock == 56 )||
        (d.latBlock == 8 && d.lngBlock == 3 )||
        (d.latBlock == 13 && d.lngBlock == 17 )||
        (d.latBlock == 10 && d.lngBlock == 32 )||
        (d.latBlock == 13 && d.lngBlock == 44 ))
        //&&(d.hour == 11)
    )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

//console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);
var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });

var best38 = d3.min(blockdata, function (d) { 
    if(d.latBlock == 8 && d.lngBlock == 3 ){
    return parseInt(d.ClientMacAddr); 
    }
});
var targettime38 = 0
for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best38)
    {
        //console.log("3333333333")
        targettime38 = blockdata[i].hour
    }
}
//console.log(blockdata)

// rect for (3,8)
    svg.append("g")
        .append("rect")
        .attr("x","300")
        .attr("y",200+590-356-42+20)
        .attr("height","55")
        .attr("width","200")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(blockdata)
                 d3.select(this)
                    .attr("x","290")
                    .attr("y",200+590-356-42+20-15+5)
                    .attr("height","75")
                    .attr("width","220")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)
                 svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","350")
                    .attr("opacity",0.3)
                    .attr("fill","black")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",920)
                    .attr("y",110)
                    .text(targettime38)

              })
        .on("mouseout", function(d) {
                svg.select("#information").remove()
                d3.select(this)
                .attr("x","300")
                .attr("y",200+590-356-42+20)
                .attr("height","55")
                .attr("width","200")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")

            })

// rect for (17,13)
    svg.append("g")
        .append("rect")
        .attr("x","408")
        .attr("y",200+590-356-42+23-70)
        .attr("height","55")
        .attr("width","130")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","396")
                    .attr("y",200+590-356-42+23-70-10)
                    .attr("height","75")
                    .attr("width","150")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
                d3.select(this)
                .attr("x","408")
                .attr("y",200+590-356-42+23-70)
                .attr("height","55")
                .attr("width","130")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })

// rect for (25,10)
    svg.append("g")
        .append("rect")
        .attr("x","665")
        .attr("y",200+590-356-42+23-70+200-20-30+10)
        .attr("height","90")
        .attr("width","155")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","654")
                    .attr("y",200+590-356-42+23-70+200-20-30+10-3)
                    .attr("height","95")
                    .attr("width","170")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
                d3.select(this)
                .attr("x","665")
                .attr("y",200+590-356-42+23-70+200-20-30+10)
                .attr("height","90")
                .attr("width","155")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })


// rect for (32,10)
    svg.append("g")
        .append("rect")
        .attr("x","720")
        .attr("y",365)
        .attr("height","107")
        .attr("width","185")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")

        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","710")
                    .attr("y",352)
                    .attr("height","127")
                    .attr("width","205")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
                d3.select(this)
                .attr("x","720")
                .attr("y",365)
                .attr("height","107")
                .attr("width","185")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })


// rect for (44,13)
svg.append("g")
        .append("rect")
        .attr("x","1090")
        .attr("y",470)
        .attr("height","130")
        .attr("width","125")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","1080")
                    .attr("y",460)
                    .attr("height","150")
                    .attr("width","145")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
                d3.select(this)
                .attr("x","1090")
                .attr("y",470)
                .attr("height","130")
                .attr("width","125")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })

// rect for (56,9)

svg.append("g")
        .append("rect")
        .attr("x","1280")
        .attr("y",435)
        .attr("height","73")
        .attr("width","125")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","1270")
                    .attr("y",425)
                    .attr("height","93")
                    .attr("width","145")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
                d3.select(this)
                .attr("x","1280")
                .attr("y",435)
                .attr("height","73")
                .attr("width","125")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })

/*
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","10")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.9;
        })
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            console.log("lng: "+d.lngBlock+" lat: "+d.latBlock+" location: "+skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY))
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+590-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill","red")
*/
    })
   } 
}





}

var svg = d3.select("#heat"),
  width = +svg.attr("width"),
  height = +svg.attr("height");
/*
function skyscale(x, y) {
    if(y>50){console.log("!!!!!!!!")}
    var scalex = d3.scaleLinear();
		scalex.domain([0,50])
		     .range([190,1390]);				 
    var newx = scalex(x);
    
    var scaley = d3.scaleLinear();
		scaley.domain([0,50])
		     .range([200,590]);				 
    var newy = scaley(y);
    //console.log(x)
    return [newx, newy];
}
*/
/*
function color(count){
    //console.log(count)
    var res = d3.scaleLinear()
  .domain([d3.min(blockdata.count), d3.max(blockdata.count)])
  .range(['rgb(255, 245, 235)', 'rgb(127, 39, 4)']);
    console.log(res(count))
    return res(count);
}
*/



  /*
  svg.append("rect")
        .attr("width","10")
        .attr("height","10")
        .attr("x","1390")
        .attr("y","590")
        .attr("fill","red")
    */

// Load data from data.csv to d3, implementing data join to draw the heatmap
d3.csv("data/4/25/level0.csv"
, function (d) {  //d contains datum of current row
    if(
        d.hour == 11 )
    {
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);

var op = d3.scaleLinear()
  .domain([minCount,30])
  .range([0,1]);


    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+590-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})
 
 

 

// Here is the logic of time-picker
$('.form_datetime').datetimepicker({
        language:  'us',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		forceParse: 0,
        showMeridian: 1
    });
	$('.form_date').datetimepicker({
        language:  'us',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
    });
	$('.form_time').datetimepicker({
        language:  'us',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 1,
		minView: 0,
		maxView: 1,
		forceParse: 0
    });


/*
var heatmapInstance = h337.create({
    container: document.querySelector('#heatmap'),
    //container: document.getElementById('#heatmap'),
});
var points = [];
var max = 0;
var width = 2600;
var height = 400;
var len = 100;
while (len--) {
    var val = Math.floor(Math.random()*100);
    max = Math.max(max, val);
    var point = {
        x: Math.floor(Math.random()*width),
        y: Math.floor(Math.random()*height),
        value: val
    };
    points.push(point);
}
var data2 = {
    max: max,
    data: points
};

heatmapInstance.setData(data2); //数据绑定还可以使用

*/


</script>

</body>


</html>

