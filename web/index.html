<html>

<head>

<link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="./buttons.css" rel="stylesheet" media="screen">
<link href="./date-picker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">

<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://d3js.org/d3-queue.v3.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>

<script type="text/javascript" src="./jquery/jquery-1.8.3.min.js" charset="UTF-8"></script>
<script type="text/javascript" src="./bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="./date-picker/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<!--
<script type="text/javascript" src="./date-picker/js/locales/bootstrap-datetimepicker.us.js" charset="UTF-8"></script> 
-->

<!--
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
-->

<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>


<style>
        #heatmap  {
            width:600px; height:400px;border: 1px solid;border-color: grey;
        }
    </style>      
</head>

<body>
<!-- Add a date time & picker using Bootstrap -->
  <div class="container">
    <form action="" class="form-horizontal"  role="form">
        <fieldset>

            <legend>Choose Date and Time</legend>

            <div class="form-group">
                <label for="dtp_input1" class="col-md-2 control-label">DateTime Picking</label>
                <div class="input-group date form_datetime col-md-5" data-date="2018-04-25T09:30:00Z" data-date-format="dd MM yyyy ----- HH:ii p" data-link-field="dtp_input1">
                    <input class="form-control" size="18" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
					<span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                </div>
				<input type="hidden" id="dtp_input1" value="" /><br/>
            </div>

<!--
			<div class="form-group">
                <label for="dtp_input2" class="col-md-2 control-label">Date Picking</label>
                <div class="input-group date form_date col-md-5" data-date="" data-date-format="dd MM yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
					<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                </div>
				<input type="hidden" id="dtp_input2" value="" /><br/>
            </div>
			<div class="form-group">
                <label for="dtp_input3" class="col-md-2 control-label">Time Picking</label>
                <div class="input-group date form_time col-md-5" data-date="" data-date-format="hh:ii" data-link-field="dtp_input3" data-link-format="hh:ii">
                    <input class="form-control" size="16" type="text" value="" readonly>
                    <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
					<span class="input-group-addon"><span class="glyphicon glyphicon-time"></span></span>
                </div>
				<input type="hidden" id="dtp_input3" value="" /><br/>
            </div>
-->
            
            <div class="col-md-2"></div>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="heatmap" checked> Heatmap
                
            </label>
            <label class="radio-inline">
                <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="time" checked> Best Visiting Time
            </label> 

            <br>
            <br>

            <div class="col-md-2"></div>
            <div class="button-group">
            <button onclick="floorb1();fun()" class="button button-glow button-rounded button-caution" id = "fb1"  type="button">B1F</button>
            <button onclick="floor1();fun()" class="button button-glow button-rounded button-caution" id = "f1"  type="button">1F</button>
            <button onclick="floor5();fun()" class="button button-glow button-rounded button-caution" id = "f5"  type="button">5F</button>
            </div>


<!--      

            <button onclick="fun()" class="button button-glow button-rounded button-caution" id = "reset"  type="button">Heatmap</button>
            <button onclick="fun()" class="button button-glow button-rounded button-caution" id = "reset"  type="button">Best Time</button>
-->
        </fieldset>
    </form>
</div>    

<div class="col-md-7">
    <svg id = "heat" version="1.1"    width="1500" height="800" viewBox="-170 180 1800 800"
     

        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">

       <image xlink:href="floor b1.png" width="1500" height="800"/>

       

    </svg>

</div>

<!--     
<div id="heatmap"></div>   
-->    
<script type="text/javascript">

var floor = 0;
console.log(floor)

var flag =""

function skyscale(x, y,minX,maxX,minY,maxY) {
    if(y>39){console.log("!!!!!!!!")}
    var scalex = d3.scaleLinear();
		scalex.domain([0,60])
		     .range([190,1390]);				 
    var newx = scalex(x);
    
    var scaley = d3.scaleLinear();
		scaley.domain([0,20])
		     .range([200,590]);				 
    var newy = scaley(y);
    //console.log(x, y,minX,maxX,minY,maxY)
    return [newx, newy];
}

function scale1(x, y,minX,maxX,minY,maxY) {
    if(y>39){console.log("!!!!!!!!")}
    var scalex = d3.scaleLinear();
		scalex.domain([0,60])
		     .range([165,1380]);				 
    var newx = scalex(x);
    
    var scaley = d3.scaleLinear();
		scaley.domain([0,20])
		     .range([195,570]);				 
    var newy = scaley(y);
    //console.log(x, y,minX,maxX,minY,maxY)
    return [newx, newy];
}

function scale5(x, y,minX,maxX,minY,maxY) {
    if(y>39){console.log("!!!!!!!!")}
    var scalex = d3.scaleLinear();
		scalex.domain([0,30])
		     .range([210,1450]);				 
    var newx = scalex(x);
    
    var scaley = d3.scaleLinear();
		scaley.domain([0,20])
		     .range([200,570]);				 
    var newy = scaley(y);
    //console.log(x, y,minX,maxX,minY,maxY)
    return [newx, newy];
}

function floorb1(){
    d3.selectAll("image").remove()
    d3.selectAll("g").remove()
    g = d3.select("#heat")
            .append("image")
            .attr("xlink:href","floor b1.png")
            .attr("width","1500")
            .attr("height","800")

    floor = 0
    console.log(floor)

}

function floor1(){
    d3.selectAll("image").remove()
    d3.selectAll("g").remove()
    g = d3.select("#heat")
            .append("image")
            .attr("xlink:href","floor 1.png")
            .attr("width","1500")
            .attr("height","800")

    floor = 1
    console.log(floor)
    //console.log("$$$$$$$$$$$")
    

}

function floor5(){
    d3.selectAll("image").remove()
    d3.selectAll("g").remove()
    g = d3.select("#heat")
            .append("image")
            .attr("xlink:href","floor 5.png")
            .attr("width","1500")
            .attr("height","800")

    floor = 5
    console.log(floor)
/*
    d3.select("#heat")
        .append("rect")
        .attr("width","24")
        .attr("height","7")
        .attr("x","210")
        .attr("y","570")
        .attr("fill","black")
*/
}



function fun(){

//alert($("input[name='inlineRadioOptions']:checked").val());

var flag = $("input[name='inlineRadioOptions']:checked").val();
/*
for(i=0;i<document.getElementsByName("inlineRadioOptions").length;i++)
 {
  if(document.getElementsByName("inlineRadioOptions")[i].checked == true)
  {
   flag = document.getElementsByName("inlineRadioOptions")[i].value;
  }
  else continue;
 }
*/

//flag = document.getElementsByName("inlineRadioOptions")[0].value

console.log(flag)

d3.selectAll("g").remove()
//var x = document.getElementById("dtp_input2").value
//var y = document.getElementById("dtp_input3").value

if(flag == "heatmap")
{
var dt = document.getElementById("dtp_input1").value
//console.log(z)

//Get Date and Time for timepicker
var z = dt.split(" ")

var month = z[0].split("-")[1]



if(month[0] == "0")
{
    month = month[1]
}
var day = z[0].split("-")[2]
var hour = z[1].split(":")[0]
var minute = 0
if(day[0] == "0")
{
    day = day[1]
}
if(hour[0] == "0")
{
    hour = hour[1]
}

var file = "data/"+month+"/"+day+"/"
}
else if(flag == "time")
{
var dt = document.getElementById("dtp_input1").value
//console.log(z)

//Get Date and Time for timepicker
var z = dt.split(" ")

var month = z[0].split("-")[1]



if(month[0] == "0")
{
    month = month[1]
}
var day = z[0].split("-")[2]
var hour = z[1].split(":")[0]
var minute = 0
if(day[0] == "0")
{
    day = day[1]
}
if(hour[0] == "0")
{
    hour = hour[1]
}

var file = "data/"+month+"/"+day+"/"
}
/*
if( z[1].split(":")[1] == "00" || z[1].split(":")[1] == "05"|| z[1].split(":")[1] == "10")
{
    minute = 0
}
else if( z[1].split(":")[1] == "15" || z[1].split(":")[1] == "20"|| z[1].split(":")[1] == "25")
{
    minute = 1
}
else if( z[1].split(":")[1] == "30" || z[1].split(":")[1] == "35"|| z[1].split(":")[1] == "40")
{
    minute = 2
}
else if( z[1].split(":")[1] == "45" || z[1].split(":")[1] == "50"|| z[1].split(":")[1] == "55")
{
    minute = 3
}
*/

//console.log(month)
//console.log(day)
//console.log(hour)
//console.log(minute)
if(flag == "heatmap")
{
if(floor == 0)
{
//target = file+"level0.csv"
//console.log(target)
d3.csv(file+"level0.csv"
, function (d) {  //d contains datum of current row


    if(d.Level == 0 && d.hour == hour )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
//console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);

var svg = d3.select("#heat")
    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+590-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})

}
else if(floor == 1)
{



d3.csv(file+"level1.csv"
, function (d) {  //d contains datum of current row
    //console.log(d)
    if(d.Level == 1 && d.hour == hour )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);

var svg = d3.select("#heat")
    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (195+570-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})

}
else if(floor ==5)
{
    d3.csv(file+"level5.csv"
, function (d) {  //d contains datum of current row
    //console.log(d)
    if(d.Level == 5 && d.hour == hour )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-30,50])
  .range(['#EFECEC','#CE0000']);

var svg = d3.select("#heat")
    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+570-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})

}
}


else if(flag == "time")
{




   if(floor == 0)
   {
    var svg = d3.select("#heat")
    d3.csv(file+"level0.csv"
    //d3.csv(file+"level0.csv"
        , function (d) {  //d contains datum of current row


    if
    (
        ((d.latBlock == 10 && d.lngBlock == 25 )||
        (d.latBlock == 9 && d.lngBlock == 56 )||
        (d.latBlock == 8 && d.lngBlock == 3 )||
        (d.latBlock == 13 && d.lngBlock == 17 )||
        (d.latBlock == 10 && d.lngBlock == 32 )||
        (d.latBlock == 13 && d.lngBlock == 44 ))
        //&&(d.hour == 11)
    )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

//console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);
var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });

var best38one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 8 && d.lngBlock == 3 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best38two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 8 && d.lngBlock == 3 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best38one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best38three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 8 && d.lngBlock == 3 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best38one && d.ClientMacAddr!=best38two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime38one = 0
var targettime38two = 0
var targettime38three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best38one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime38one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best38two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime38two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best38three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime38three = blockdata[i].hour
    }

}


var best1713one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 17 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best1713two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 17 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best1713one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best1713three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 17 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best1713one && d.ClientMacAddr!=best1713two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime1713one = 0
var targettime1713two = 0
var targettime1713three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best1713one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime1713one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best1713two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime1713two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best1713three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime1713three = blockdata[i].hour
    }

}

//get best time for a specific block--------------------------------------
var best2510one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 10 && d.lngBlock == 25 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best2510two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 10 && d.lngBlock == 25 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best2510one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best2510three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 10 && d.lngBlock == 25 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best2510one && d.ClientMacAddr!=best2510two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime2510one = 0
var targettime2510two = 0
var targettime2510three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best2510one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime2510one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best2510two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime2510two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best2510three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime2510three = blockdata[i].hour
    }

}
//---------------------------------------------------------
//get best time for a specific block--------------------------------------
var best3210one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 10 && d.lngBlock == 32 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best3210two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 10 && d.lngBlock == 32 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best3210one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best3210three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 10 && d.lngBlock == 32 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best3210one && d.ClientMacAddr!=best3210two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime3210one = 0
var targettime3210two = 0
var targettime3210three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best3210one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime3210one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best3210two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime3210two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best3210three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime3210three = blockdata[i].hour
    }

}
//---------------------------------------------------------
//get best time for a specific block--------------------------------------
var best4413one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 44 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best4413two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 44 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best4413one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best4413three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 44 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best4413one && d.ClientMacAddr!=best4413two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime4413one = 0
var targettime4413two = 0
var targettime4413three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best4413one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime4413one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best4413two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime4413two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best4413three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime4413three = blockdata[i].hour
    }

}
//---------------------------------------------------------
//get best time for a specific block--------------------------------------
var best569one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 56 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best569two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 56 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best569one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best569three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 56 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best569one && d.ClientMacAddr!=best569two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime569one = 0
var targettime569two = 0
var targettime569three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best569one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime569one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best569two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime569two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best569three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime569three = blockdata[i].hour
    }

}
//---------------------------------------------------------

// rect for (3,8)
    svg.append("g")
        .append("rect")
        .attr("x","300")
        .attr("y",200+590-356-42+20)
        .attr("height","55")
        .attr("width","200")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(blockdata)
                 d3.select(this)
                    .attr("x","290")
                    .attr("y",200+590-356-42+20-15+5)
                    .attr("height","75")
                    .attr("width","220")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)

//----------------------copy here!!!--------------------
                 svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime38one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime38two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime38three+":00")
//---------------------------------------------------

              })
        .on("mouseout", function(d) {
                svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","300")
                .attr("y",200+590-356-42+20)
                .attr("height","55")
                .attr("width","200")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")

            })



// rect for (17,13)
    svg.append("g")
        .append("rect")
        .attr("x","408")
        .attr("y",200+590-356-42+23-70)
        .attr("height","55")
        .attr("width","130")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","396")
                    .attr("y",200+590-356-42+23-70-10)
                    .attr("height","75")
                    .attr("width","150")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime1713one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime1713two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime1713three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","408")
                .attr("y",200+590-356-42+23-70)
                .attr("height","55")
                .attr("width","130")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })


// rect for (25,10)
    svg.append("g")
        .append("rect")
        .attr("x","665")
        .attr("y",200+590-356-42+23-70+200-20-30+10)
        .attr("height","90")
        .attr("width","155")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","654")
                    .attr("y",200+590-356-42+23-70+200-20-30+10-3)
                    .attr("height","95")
                    .attr("width","170")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime2510one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime2510two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime2510three+":00")

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","665")
                .attr("y",200+590-356-42+23-70+200-20-30+10)
                .attr("height","90")
                .attr("width","155")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })


// rect for (32,10)
    svg.append("g")
        .append("rect")
        .attr("x","720")
        .attr("y",365)
        .attr("height","107")
        .attr("width","185")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")

        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","710")
                    .attr("y",352)
                    .attr("height","127")
                    .attr("width","205")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)
                    svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime3210one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime3210two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime3210three+":00")
              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","720")
                .attr("y",365)
                .attr("height","107")
                .attr("width","185")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })


// rect for (44,13)
svg.append("g")
        .append("rect")
        .attr("x","1090")
        .attr("y",470)
        .attr("height","130")
        .attr("width","125")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","1080")
                    .attr("y",460)
                    .attr("height","150")
                    .attr("width","145")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)
                    svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime4413one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime4413two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime4413three+":00")
              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","1090")
                .attr("y",470)
                .attr("height","130")
                .attr("width","125")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })

// rect for (56,9)

svg.append("g")
        .append("rect")
        .attr("x","1280")
        .attr("y",435)
        .attr("height","73")
        .attr("width","125")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","1270")
                    .attr("y",425)
                    .attr("height","93")
                    .attr("width","145")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                    //.text(d.value)
                    svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime569one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime569two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime569three+":00")
              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","1280")
                .attr("y",435)
                .attr("height","73")
                .attr("width","125")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })

/*
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","10")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.9;
        })
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            console.log("lng: "+d.lngBlock+" lat: "+d.latBlock+" location: "+skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY))
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+590-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill","red")
*/
    })
   } 


   else if(floor == 1)
   {

    var svg = d3.select("#heat")
    d3.csv(file+"level1.csv"
    //d3.csv(file+"level0.csv"
        , function (d) {  //d contains datum of current row


    if
    (
        ((d.latBlock == 3 && d.lngBlock == 29 )||
        (d.latBlock == 4 && d.lngBlock == 45 )||
        (d.latBlock == 12 && d.lngBlock == 57 )||
        (d.latBlock == 13 && d.lngBlock == 41 )||
        (d.latBlock == 17 && d.lngBlock == 54 )||
        (d.latBlock == 8 && d.lngBlock == 21  )||
        (d.latBlock == 12 && d.lngBlock == 7 )||
        (d.latBlock == 9 && d.lngBlock == 0 ))
        //&&(d.hour == 11))
    )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
/*
        svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","5")
        //.attr("height","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (195+570-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill","red")
*/
var best09one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 0 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});

var best09two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 0 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best09one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best09three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 0 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best09one && d.ClientMacAddr!=best09two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime09one = 0
var targettime09two = 0
var targettime09three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best09one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime09one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best09two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime09two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best09three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime09three = blockdata[i].hour
    }

}


var best712one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 12 && d.lngBlock == 7 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best712two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 12 && d.lngBlock == 7 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best712one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best712three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 12 && d.lngBlock == 7 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best712one && d.ClientMacAddr!=best712two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime712one = 0
var targettime712two = 0
var targettime712three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best712one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime712one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best712two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime712two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best712three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime712three = blockdata[i].hour
    }

}

//get best time for a specific block--------------------------------------
var best218one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 8 && d.lngBlock == 21 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best218two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 8 && d.lngBlock == 21 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best218one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best218three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 8 && d.lngBlock == 21 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best218one && d.ClientMacAddr!=best218two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime218one = 0
var targettime218two = 0
var targettime218three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best218one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime218one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best218two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime218two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best218three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime218three = blockdata[i].hour
    }

}
//---------------------------------------------------------
//get best time for a specific block--------------------------------------
var best293one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 3 && d.lngBlock == 29 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best293two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 3 && d.lngBlock == 29 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best293one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best293three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 3 && d.lngBlock == 29 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best293one && d.ClientMacAddr!=best293two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime293one = 0
var targettime293two = 0
var targettime293three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best293one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime293one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best293two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime293two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best293three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime293three = blockdata[i].hour
    }

}
//---------------------------------------------------------
//get best time for a specific block--------------------------------------
var best4113one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 41 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best4113two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 41 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best4113one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best4113three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 13 && d.lngBlock == 41 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best4113one && d.ClientMacAddr!=best4113two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime4113one = 0
var targettime4113two = 0
var targettime4113three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best4113one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime4113one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best4113two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime4113two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best4113three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime4113three = blockdata[i].hour
    }

}
//---------------------------------------------------------
//get best time for a specific block--------------------------------------
var best454one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 4 && d.lngBlock == 45 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best454two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 4 && d.lngBlock == 45 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best454one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best454three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 4 && d.lngBlock == 45 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best454one && d.ClientMacAddr!=best454two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime454one = 0
var targettime454two = 0
var targettime454three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best454one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime454one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best454two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime454two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best454three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime454three = blockdata[i].hour
    }

}
//---------------------------------------------------------

//get best time for a specific block--------------------------------------
var best5712one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 12 && d.lngBlock == 57 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best5712two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 12 && d.lngBlock == 57 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best5712one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best5712three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 12 && d.lngBlock == 57 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best5712one && d.ClientMacAddr!=best5712two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime5712one = 0
var targettime5712two = 0
var targettime5712three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best5712one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime5712one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best5712two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime5712two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best5712three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime5712three = blockdata[i].hour
    }

}
//---------------------------------------------------------

//(0,9)-----------------------
    svg.append("g")
        .append("rect")
        .attr("x",180)
        .attr("y",410)
        .attr("height","155")
        .attr("width","130")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","170")
                    .attr("y",400)
                    .attr("height","175")
                    .attr("width","150")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime09one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime09two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime09three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","180")
                .attr("y",410)
                .attr("height","155")
                .attr("width","130")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------


//(7,12)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",345)
        .attr("y",425)
        .attr("height",105)
        .attr("width",110)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",335)
                    .attr("y",415)
                    .attr("height",125)
                    .attr("width",130)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime712one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime712two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime712three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",345)
                .attr("y",425)
                .attr("height",105)
                .attr("width",110)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------

//(21,8)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",500)
        .attr("y",450)
        .attr("height",127)
        .attr("width",67)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",490)
                    .attr("y",440)
                    .attr("height",147)
                    .attr("width",87)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime218one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime218two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime218three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",490)
                .attr("y",440)
                .attr("height",127)
                .attr("width",67)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------

//(29,3)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",825)
        .attr("y",505)
        .attr("height",50)
        .attr("width",170)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",810)
                    .attr("y",495)
                    .attr("height",70)
                    .attr("width",190)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime293one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime293two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime293three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",825)
                .attr("y",505)
                .attr("height",50)
                .attr("width",170)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------

//(41,13)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",800)
        .attr("y",290)
        .attr("height",140)
        .attr("width",250)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",790)
                    .attr("y",280)
                    .attr("height",160)
                    .attr("width",270)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime4113one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime4113two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime4113three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",800)
                .attr("y",290)
                .attr("height",140)
                .attr("width",250)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------

//(45,4)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",1140)
        .attr("y",503)
        .attr("height",55)
        .attr("width",100)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",1130)
                    .attr("y",493)
                    .attr("height",75)
                    .attr("width",120)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime454one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime454two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime454three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",1140)
                .attr("y",503)
                .attr("height",55)
                .attr("width",100)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------

//(57,12)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",1240)
        .attr("y",435)
        .attr("height",57)
        .attr("width",160)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",1230)
                    .attr("y",425)
                    .attr("height",77)
                    .attr("width",180)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime5712one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime5712two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime5712three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",1240)
                .attr("y",435)
                .attr("height",57)
                .attr("width",160)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------
        })
   }

   else if(floor ==5)
   {
    var svg = d3.select("#heat")
    d3.csv(file+"level5.csv"
    //d3.csv(file+"level0.csv"
        , function (d) {  //d contains datum of current row


    if
    (
        ((d.latBlock == 6 && d.lngBlock == 9 )||
        (d.latBlock == 7 && d.lngBlock == 13 )||
        (d.latBlock == 9 && d.lngBlock == 28 ))
        //&&(d.hour == 11))
    )
    {
        //console.log(d)
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
/*
        svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","5")
        //.attr("height","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (195+570-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill","red")
*/
var best96one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 6 && d.lngBlock == 9 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});

var best96two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 6 && d.lngBlock == 9 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best96one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best96three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 6 && d.lngBlock == 9 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best96one && d.ClientMacAddr!=best96two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime96one = 0
var targettime96two = 0
var targettime96three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best96one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime96one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best96two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime96two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best96three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime96three = blockdata[i].hour
    }

}


var best137one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 7 && d.lngBlock == 13 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best137two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 7 && d.lngBlock == 13 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best137one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best137three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 7 && d.lngBlock == 13 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best137one && d.ClientMacAddr!=best137two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime137one = 0
var targettime137two = 0
var targettime137three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best137one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime137one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best137two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime137two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best137three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime137three = blockdata[i].hour
    }

}

//get best time for a specific block--------------------------------------
var best289one = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 28 && d.hour>=9 && d.hour<=18){
    return parseInt(d.ClientMacAddr); 
    }
});
var best289two = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 28 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best289one){
    return parseInt(d.ClientMacAddr); 
    }
});
var best289three = d3.min(blockdata, function (d) { 
    if(d.latBlock == 9 && d.lngBlock == 28 && d.hour>=9 && d.hour<=18 && d.ClientMacAddr!=best289one && d.ClientMacAddr!=best289two){

    return parseInt(d.ClientMacAddr); 
    }
});

var targettime289one = 0
var targettime289two = 0
var targettime289three = 0

for(i=0;i<blockdata.length;i++)
{   
    //console.log("2222222")
    if(blockdata[i].ClientMacAddr==best289one && blockdata[i].hour>=9 && blockdata[i].hour<=18 )
    {
        //console.log("3333333333")
        targettime289one = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best289two && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime289two = blockdata[i].hour
    }
    if(blockdata[i].ClientMacAddr==best289three && blockdata[i].hour>=9 && blockdata[i].hour<=18)
    {
        //console.log("3333333333")
        targettime289three = blockdata[i].hour
    }

}
//---------------------------------------------------------


//(9,6)-----------------------
    svg.append("g")
        .append("rect")
        .attr("x",250)
        .attr("y",460)
        .attr("height","120")
        .attr("width","105")
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x","240")
                    .attr("y",450)
                    .attr("height","140")
                    .attr("width","125")
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height","200")
                    .attr("width","330")
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime96one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime96two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime96three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x","250")
                .attr("y",460)
                .attr("height","120")
                .attr("width","105")
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------


//(13,7)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",395)
        .attr("y",460)
        .attr("height",117)
        .attr("width",170)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",385)
                    .attr("y",450)
                    .attr("height",137)
                    .attr("width",190)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime137one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime137two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime137three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",395)
                .attr("y",460)
                .attr("height",117)
                .attr("width",170)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })
//---------------------------------

//(28,9)-----------------------
svg.append("g")
        .append("rect")
        .attr("x",890)
        .attr("y",440)
        .attr("height",127)
        .attr("width",480)
        .attr("rx",20)
        .attr("ry",20)
        .attr("fill","green")
        .attr("opacity","0.4")
        .attr("stroke","green")
        .attr("stroke-width","15")
        .attr("stroke-opacity","0.7")
        .on("mouseover", function(d) {
                  //console.log(d)
                 d3.select(this)
                    .attr("x",880)
                    .attr("y",430)
                    .attr("height",147)
                    .attr("width",500)
                    .attr("opacity","0.5")
                    .attr("stroke-width","20")
                    .attr("stroke-opacity","0.9")
                svg.append("rect")
                    .attr("x",920)
                    .attr("y",110)
                    .attr("height",200)
                    .attr("width",330)
                    .attr("opacity",0.7)
                    .attr("fill","white")
                    .attr("stroke","black")
                    .attr("stroke-width","3")
                    .attr("rx",20)
                    .attr("ry",20)
                    .attr("id","information")

                svg.append("text")
                    .attr("x",950)
                    .attr("y",150)
                    .attr("fill","black")
                    .attr("font-size","35px")
                    .text("Best Visiting Time")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",200)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime289one+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",240)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime289two+":00")

                svg.append("text")
                    .attr("x",960)
                    .attr("y",280)
                    .attr("fill","black")
                    .attr("font-size","30px")
                    .text(targettime289three+":00")
                    //.text(d.value)

              })
        .on("mouseout", function(d) {
            svg.select("#information").remove()
                svg.selectAll("text").remove()
                d3.select(this)
                .attr("x",890)
                .attr("y",440)
                .attr("height",127)
                .attr("width",480)
                .attr("rx",20)
                .attr("ry",20)
                .attr("opacity","0.4")
                .attr("stroke-width","15")
                .attr("stroke-opacity","0.7")
            })

//---------------------------------
        })
   }








   }

}

var svg = d3.select("#heat"),
  width = +svg.attr("width"),
  height = +svg.attr("height");



// Load data from data.csv to d3, implementing data join to draw the heatmap
d3.csv("data/4/25/level0.csv"
, function (d) {  //d contains datum of current row
    if(
        d.hour == 11 )
    {
        return  d ;
    }
}).then(function(blockdata){

var minCount= d3.min(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var maxCount = d3.max(blockdata, function (d) { return parseInt(d.ClientMacAddr); });
var minX= d3.min(blockdata, function (d) { return parseInt(d.latBlock); });
var maxX= d3.max(blockdata, function (d) { return parseInt(d.latBlock); });
var minY= d3.min(blockdata, function (d) { return parseInt(d.lngBlock); });
var maxY= d3.max(blockdata, function (d) { return parseInt(d.lngBlock); });
console.log(minCount,maxCount,minX,maxX,minY,maxY)

// Function skyscale() scales the coordinate of the blocks to fit the background floorplan image

// Use scaleLinear to produce different color code
var res = d3.scaleLinear()
  .domain([-2,70])
  .range(['#EFECEC','#CE0000']);

var op = d3.scaleLinear()
  .domain([minCount,30])
  .range([0,1]);


    //console.log(blockdata)

    
// Draw the blocks on the floorplan
    svg.append("g")
        .attr("class","blocks")
        .selectAll("circle")
        .data(blockdata)
        .enter()
        .append("circle")
        .attr("r","13")
        //.attr("height","8")
        .attr("opacity",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return op(d.count);
           return 0.75;
        })
        .attr("stroke",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
        })
        .attr("stroke-width","3")
        .attr("stroke-opacity","0.6")
        //.attr("rx","15")
        //.attr("ry","8")
        .attr("cx",function(d)
        {   //console.log(d)
            //console.log(d.latBlock)
           // console.log(laProjection(d.geometry.coordinates))
            //return 190+1390-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
            return skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[0];
        })
        .attr("cy",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           //return (skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
           return (200+590-skyscale(d.lngBlock,d.latBlock,minX,maxX,minY,maxY)[1]);
        })
        .attr("fill",function(d)
        {
           // console.log(laProjection(d.geometry.coordinates))
           return res(d.ClientMacAddr);
           //return "red";
        })

})
 
 

 

// Here is the logic of time-picker
$('.form_datetime').datetimepicker({
        language:  'us',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		forceParse: 0,
        showMeridian: 1
    });
	$('.form_date').datetimepicker({
        language:  'us',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
    });
	$('.form_time').datetimepicker({
        language:  'us',
        weekStart: 1,
        todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 1,
		minView: 0,
		maxView: 1,
		forceParse: 0
    });




</script>

</body>


</html>

